unit_test:
  stage: unit_test
  tags:
    - ${RUNNER}
  before_script:
    - mkdir -p ut
  script:
    - go test -coverpkg=./... -coverprofile=coverage.data -timeout=1200s ./...
    - go tool cover -html=coverage.data -o coverage.html
    - go tool cover -func=coverage.data -o coverage.txt
    - cat coverage.txt
    - mv coverage.html ./ut
  coverage: '/total:+\s+\(statements\)+\s+\d+.\d+%/'
  artifacts:
    expire_in: 1d
    paths:
      - ut/coverage.html
      - coverage.txt
  cache:
    key: "yasinServer"
    paths:
      - ut/coverage.html
      - coverage.txt
  retry: 2
